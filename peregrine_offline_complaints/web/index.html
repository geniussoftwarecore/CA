<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุธุงู ุดูุงูู ุจูุฑูุฑูู - Peregrine Complaints</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1976d2">
    <!-- Local Arabic fonts will be loaded via CSS -->
</head>
<body>
    <div id="app">
        <!-- Loading Screen -->
        <div id="loading" class="screen active">
            <div class="loading-container">
                <div class="spinner"></div>
                <h2>ุฌุงุฑู ุงูุชุญููู...</h2>
                <p>ูุธุงู ุดูุงูู ุจูุฑูุฑูู</p>
            </div>
        </div>

        <!-- Role Selection Screen -->
        <div id="roleSelection" class="screen">
            <div class="container">
                <header class="header">
                    <h1>ูุธุงู ุดูุงูู ุจูุฑูุฑูู</h1>
                    <p>ูุธุงู ุฅุฏุงุฑุฉ ุงูุดูุงูู ุงููุญูู</p>
                </header>

                <div class="role-cards">
                    <div class="role-card" onclick="selectRole('client')">
                        <div class="role-icon">๐ค</div>
                        <h3>ุนููู</h3>
                        <p>ุชูุฏูู ุดููู ุฌุฏูุฏุฉ ุฃู ูุชุงุจุนุฉ ุงูุดูุงูู ุงูููุฏูุฉ</p>
                    </div>

                    <div class="role-card" onclick="selectRole('support')">
                        <div class="role-icon">๐๏ธ</div>
                        <h3>ูุฌูุฉ ุงูุฏุนู</h3>
                        <p>ูุฑุงุฌุนุฉ ููุนุงูุฌุฉ ุงูุดูุงูู ุงููุงุฑุฏุฉ</p>
                        <div class="pin-required">๐ ูุชุทูุจ ุฑูุฒ PIN</div>
                    </div>

                    <div class="role-card" onclick="selectRole('coordination')">
                        <div class="role-icon">โ๏ธ</div>
                        <h3>ูุฌูุฉ ุงูุชูุณูู ุงูุนููุง</h3>
                        <p>ุงููุฑุงุฌุนุฉ ุงูููุงุฆูุฉ ูุงููุฑุงุฑุงุช ุงูุฅุฏุงุฑูุฉ</p>
                        <div class="pin-required">๐ ูุชุทูุจ ุฑูุฒ PIN</div>
                    </div>
                </div>

                <div class="settings-panel">
                    <button class="settings-btn" onclick="showSettings()">โ๏ธ ุงูุฅุนุฏุงุฏุงุช</button>
                    <button class="theme-btn" onclick="toggleTheme()">๐ ุงููุถุน ุงููุธูู</button>
                </div>
            </div>
        </div>

        <!-- PIN Entry Screen -->
        <div id="pinEntry" class="screen">
            <div class="container">
                <div class="pin-form">
                    <h2 id="pinTitle">ุฅุฏุฎุงู ุฑูุฒ PIN</h2>
                    <div class="pin-input-container">
                        <input type="password" id="pinInput" placeholder="ุฃุฏุฎู ุฑูุฒ PIN" maxlength="6">
                        <button onclick="window.app.verifyPin()">ุชุณุฌูู ุงูุฏุฎูู</button>
                    </div>
                    <div id="pinError" class="error-message"></div>
                    <button class="back-btn" onclick="goBack()">โ ุงูุนูุฏุฉ</button>
                </div>
            </div>
        </div>

        <!-- Client Home Screen -->
        <div id="clientHome" class="screen">
            <div class="container">
                <header class="screen-header">
                    <h2>ููุญุฉ ุงูุนููู</h2>
                    <div class="header-actions">
                        <button onclick="logout()">ุชุณุฌูู ุงูุฎุฑูุฌ</button>
                    </div>
                </header>

                <div class="dashboard-cards">
                    <div class="dashboard-card primary" onclick="showComplaintForm()">
                        <div class="card-icon">โ</div>
                        <h3>ุดููู ุฌุฏูุฏุฉ</h3>
                        <p>ุชูุฏูู ุดููู ุฌุฏูุฏุฉ</p>
                    </div>

                    <div class="dashboard-card" onclick="showMyComplaints()">
                        <div class="card-icon">๐</div>
                        <h3>ุดูุงููู</h3>
                        <p>ุนุฑุถ ุฌููุน ุงูุดูุงูู ุงูููุฏูุฉ</p>
                        <div class="badge" id="clientComplaintsCount">0</div>
                    </div>

                    <div class="dashboard-card" onclick="showExportImport()">
                        <div class="card-icon">๐</div>
                        <h3>ุชุตุฏูุฑ/ุงุณุชูุฑุงุฏ</h3>
                        <p>ุฅุฏุงุฑุฉ ุงูุจูุงูุงุช</p>
                    </div>
                </div>

                <div class="recent-complaints">
                    <h3>ุขุฎุฑ ุงูุดูุงูู</h3>
                    <div id="recentComplaintsList" class="complaints-list"></div>
                </div>
            </div>
        </div>

        <!-- Support Home Screen -->
        <div id="supportHome" class="screen">
            <div class="container">
                <header class="screen-header">
                    <h2>ููุญุฉ ูุฌูุฉ ุงูุฏุนู</h2>
                    <div class="header-actions">
                        <button onclick="logout()">ุชุณุฌูู ุงูุฎุฑูุฌ</button>
                    </div>
                </header>

                <div class="dashboard-cards">
                    <div class="dashboard-card urgent" onclick="showInboxComplaints()">
                        <div class="card-icon">๐ฅ</div>
                        <h3>ุตูุฏูู ุงููุงุฑุฏ</h3>
                        <p>ุดูุงูู ุฌุฏูุฏุฉ ูููุฏ ุงููุฑุงุฌุนุฉ</p>
                        <div class="badge urgent" id="inboxCount">0</div>
                    </div>

                    <div class="dashboard-card" onclick="showAssignedComplaints()">
                        <div class="card-icon">๐ค</div>
                        <h3>ุงููููู ุจูุง</h3>
                        <p>ุงูุดูุงูู ุงููููู ุจูุฑุงุฌุนุชูุง</p>
                        <div class="badge" id="assignedCount">0</div>
                    </div>

                    <div class="dashboard-card success" onclick="showResolvedComplaints()">
                        <div class="card-icon">โ</div>
                        <h3>ุงููุญูููุฉ</h3>
                        <p>ุงูุดูุงูู ุงููุญูููุฉ ุจูุงุณุทุฉ ุงูุฏุนู</p>
                        <div class="badge success" id="resolvedSupportCount">0</div>
                    </div>

                    <div class="dashboard-card warning" onclick="showEscalatedComplaints()">
                        <div class="card-icon">โ๏ธ</div>
                        <h3>ุงููุญููุฉ</h3>
                        <p>ุงูุดูุงูู ุงููุญููุฉ ููุชูุณูู ุงูุนููุง</p>
                        <div class="badge warning" id="escalatedCount">0</div>
                    </div>
                </div>

                <div class="daily-report">
                    <h3>ุชูุฑูุฑ ุงูููู</h3>
                    <div class="report-stats">
                        <div class="stat-item">
                            <span class="stat-value" id="todayNewCount">0</span>
                            <span class="stat-label">ุฌุฏูุฏุฉ</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="todayResolvedCount">0</span>
                            <span class="stat-label">ูุญูููุฉ</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="todayEscalatedCount">0</span>
                            <span class="stat-label">ูุญููุฉ</span>
                        </div>
                    </div>
                    <button onclick="exportDailyReport()">๐ ุชุตุฏูุฑ ุงูุชูุฑูุฑ</button>
                </div>
            </div>
        </div>

        <!-- Coordination Home Screen -->
        <div id="coordinationHome" class="screen">
            <div class="container">
                <header class="screen-header">
                    <h2>ููุญุฉ ูุฌูุฉ ุงูุชูุณูู ุงูุนููุง</h2>
                    <div class="header-actions">
                        <button onclick="logout()">ุชุณุฌูู ุงูุฎุฑูุฌ</button>
                    </div>
                </header>

                <div class="dashboard-cards">
                    <div class="dashboard-card urgent" onclick="showEscalatedToCoordination()">
                        <div class="card-icon">๐จ</div>
                        <h3>ุงููุญููุฉ ููุชูุณูู</h3>
                        <p>ุงูุดูุงูู ุงููุญููุฉ ูู ูุฌูุฉ ุงูุฏุนู</p>
                        <div class="badge urgent" id="coordinationInboxCount">0</div>
                    </div>

                    <div class="dashboard-card success" onclick="showFinalizedComplaints()">
                        <div class="card-icon">โ</div>
                        <h3>ุงูููุฌุฒุฉ ููุงุฆูุงู</h3>
                        <p>ุงูุดูุงูู ุงููุญูููุฉ ูุงููุบููุฉ</p>
                        <div class="badge success" id="finalizedCount">0</div>
                    </div>

                    <div class="dashboard-card danger" onclick="showRejectedComplaints()">
                        <div class="card-icon">โ</div>
                        <h3>ุงููุฑููุถุฉ</h3>
                        <p>ุงูุดูุงูู ุงููุฑููุถุฉ</p>
                        <div class="badge danger" id="rejectedCount">0</div>
                    </div>
                </div>

                <div class="summary-report">
                    <h3>ุงูููุฎุต ุงูุดุงูู</h3>
                    <div class="summary-grid">
                        <div class="summary-card">
                            <h4>ุฅุฌูุงูู ุงูุดูุงูู</h4>
                            <span class="summary-value" id="totalComplaints">0</span>
                        </div>
                        <div class="summary-card">
                            <h4>ูุนุฏู ุงูุญู</h4>
                            <span class="summary-value" id="resolutionRate">0%</span>
                        </div>
                        <div class="summary-card">
                            <h4>ูุชูุณุท ููุช ุงูุญู</h4>
                            <span class="summary-value" id="avgResolutionTime">-- ููู</span>
                        </div>
                    </div>
                    <button onclick="exportComprehensiveReport()">๐ ุชุตุฏูุฑ ุงูุชูุฑูุฑ ุงูุดุงูู</button>
                </div>
            </div>
        </div>

        <!-- Complaint Form Screen -->
        <div id="complaintForm" class="screen">
            <div class="container">
                <header class="screen-header">
                    <h2>ุชูุฏูู ุดููู ุฌุฏูุฏุฉ</h2>
                    <div class="header-actions">
                        <button onclick="saveComplaintDraft()">๐พ ุญูุธ ูุณูุฏุฉ</button>
                        <button onclick="goBack()">โ ุงูุนูุฏุฉ</button>
                    </div>
                </header>

                <div class="form-container">
                    <form id="complaintFormData" class="complaint-form">
                        <div class="form-step active" id="step1">
                            <h3>ุงูุฎุทูุฉ 1: ุจูุงูุงุช ููุฏู ุงูุดููู</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="firstName">ุงูุงุณู ุงูุฃูู *</label>
                                    <input type="text" id="firstName" required>
                                </div>
                                <div class="form-group">
                                    <label for="middleName">ุงูุงุณู ุงูุฃูุณุท</label>
                                    <input type="text" id="middleName">
                                </div>
                                <div class="form-group">
                                    <label for="lastName">ุงูุงุณู ุงูุฃุฎูุฑ *</label>
                                    <input type="text" id="lastName" required>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="address">ุงูุนููุงู *</label>
                                <textarea id="address" required></textarea>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="phone">ุฑูู ุงููุงุชู *</label>
                                    <input type="tel" id="phone" required>
                                </div>
                                <div class="form-group">
                                    <label for="altPhone">ุฑูู ูุงุชู ุจุฏูู</label>
                                    <input type="tel" id="altPhone">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="whatsapp">ูุงุชุณุงุจ</label>
                                    <input type="tel" id="whatsapp">
                                </div>
                                <div class="form-group">
                                    <label for="telegram">ุชููุฌุฑุงู</label>
                                    <input type="text" id="telegram">
                                </div>
                                <div class="form-group">
                                    <label for="email">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
                                    <input type="email" id="email">
                                </div>
                            </div>
                        </div>

                        <div class="form-step" id="step2">
                            <h3>ุงูุฎุทูุฉ 2: ุชูุฏูู ุงูุดููู</h3>
                            
                            <div class="form-group">
                                <label for="onBehalfOf">ุชูุฏูู ุงูุดููู:</label>
                                <select id="onBehalfOf" onchange="toggleBehalfFields()">
                                    <option value="self">ุจุงุณูู ุงูุดุฎุตู</option>
                                    <option value="organization">ุจุงุณู ููุธูุฉ/ุดุฑูุฉ</option>
                                    <option value="other">ุจุงุณู ุดุฎุต ุขุฎุฑ</option>
                                </select>
                            </div>

                            <div id="behalfFields" class="behalf-fields" style="display: none;">
                                <div class="form-group">
                                    <label for="behalfName">ุงูุงุณู ุงููุงูู ููุฌูุฉ/ุงูุดุฎุต</label>
                                    <input type="text" id="behalfName">
                                </div>
                                <div class="form-group">
                                    <label for="behalfAddress">ุงูุนููุงู</label>
                                    <input type="text" id="behalfAddress">
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="behalfPhone">ุฑูู ุงููุงุชู</label>
                                        <input type="tel" id="behalfPhone">
                                    </div>
                                    <div class="form-group">
                                        <label for="behalfWhatsapp">ูุงุชุณุงุจ</label>
                                        <input type="tel" id="behalfWhatsapp">
                                    </div>
                                    <div class="form-group">
                                        <label for="behalfTelegram">ุชููุฌุฑุงู</label>
                                        <input type="text" id="behalfTelegram">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="relation">ุตูุฉ ุงููุฑุงุจุฉ/ุงูุนูุงูุฉ</label>
                                    <input type="text" id="relation">
                                </div>
                            </div>
                        </div>

                        <div class="form-step" id="step3">
                            <h3>ุงูุฎุทูุฉ 3: ุชูุงุตูู ุงูุดููู</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="category">ูุฆุฉ ุงูุดููู *</label>
                                    <select id="category" required onchange="loadAuthorities()">
                                        <option value="">ุงุฎุชุฑ ูุฆุฉ ุงูุดููู</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="authority">ุงูุฌูุฉ ุงููุฎุชุตุฉ</label>
                                    <select id="authority">
                                        <option value="">ุงุฎุชุฑ ุงูุฌูุฉ</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="requestType">ููุน ุงูุทูุจ ูู ุงูุฌูุฉ</label>
                                <input type="text" id="requestType" placeholder="ูุง ุทูุจุชู ุงูุฌูุฉ ููู">
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="incidentDate">ุชุงุฑูุฎ ุงูุญุงุฏุซุฉ</label>
                                    <input type="date" id="incidentDate">
                                </div>
                                <div class="form-group">
                                    <label for="awarenessDate">ุชุงุฑูุฎ ุงูุนูู ุจุงููุดููุฉ</label>
                                    <input type="date" id="awarenessDate">
                                </div>
                            </div>
                        </div>

                        <div class="form-step" id="step4">
                            <h3>ุงูุฎุทูุฉ 4: ููุฎุต ุงูุดููู ูุงููุทุงูุจ</h3>
                            
                            <div class="form-group">
                                <label for="summary">ููุฎุต ุงูุดููู (ููุตู) *</label>
                                <textarea id="summary" required rows="6" placeholder="ุงุดุฑุญ ุงููุดููุฉ ุจุงูุชูุตูู..."></textarea>
                            </div>

                            <div class="form-group">
                                <label for="authorityOffer">ูู ูุฏูุช ุงูุฌูุฉ ุญูููุ</label>
                                <div class="radio-group">
                                    <label><input type="radio" name="authorityOffer" value="yes"> ูุนู</label>
                                    <label><input type="radio" name="authorityOffer" value="no" checked> ูุง</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="desiredResolution">ุงูุญู ุงููุทููุจ</label>
                                <textarea id="desiredResolution" rows="3" placeholder="ูุง ุงูุญู ุงูุฐู ุชุฑูุฏูุ"></textarea>
                            </div>

                            <div class="form-group">
                                <label for="previousComplaint">ูู ุณุจู ุชูุฏูู ุดููู ููุงุซูุฉุ</label>
                                <div class="radio-group">
                                    <label><input type="radio" name="previousComplaint" value="yes"> ูุนู</label>
                                    <label><input type="radio" name="previousComplaint" value="no" checked> ูุง</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="legalAction">ูู ุชูุฌุฏ ูุถูุฉ ูุงููููุฉุ</label>
                                <div class="radio-group">
                                    <label><input type="radio" name="legalAction" value="yes"> ูุนู</label>
                                    <label><input type="radio" name="legalAction" value="no" checked> ูุง</label>
                                </div>
                            </div>
                        </div>

                        <div class="form-step" id="step5">
                            <h3>ุงูุฎุทูุฉ 5: ุงููุฑููุงุช (ุงุฎุชูุงุฑู)</h3>
                            
                            <div class="form-group">
                                <label for="attachments">ุงููุฑููุงุช</label>
                                <input type="file" id="attachments" multiple accept="image/*,.pdf,.doc,.docx">
                                <div class="file-help">ูููู ุฅุฑูุงู ุงูุตูุฑ ูุงููุณุชูุฏุงุช (PDF, DOC, DOCX)</div>
                            </div>

                            <div id="attachmentsList" class="attachments-list"></div>

                            <div class="form-group">
                                <label for="attachmentNotes">ููุงุญุธุงุช ุนูู ุงููุฑููุงุช</label>
                                <textarea id="attachmentNotes" rows="3" placeholder="ุฃู ููุงุญุธุงุช ุนูู ุงููุฑููุงุช ุงููุถุงูุฉ"></textarea>
                            </div>
                        </div>

                        <div class="form-navigation">
                            <button type="button" id="prevStep" onclick="previousStep()" style="display: none;">ุงูุณุงุจู</button>
                            <button type="button" id="nextStep" onclick="nextStep()">ุงูุชุงูู</button>
                            <button type="submit" id="submitComplaint" style="display: none;">ุชูุฏูู ุงูุดููู</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Settings/Admin Screen -->
        <div id="settings" class="screen">
            <div class="container">
                <header class="screen-header">
                    <h2>ุงูุฅุนุฏุงุฏุงุช</h2>
                    <button onclick="goBack()">โ ุงูุนูุฏุฉ</button>
                </header>
                
                <div class="settings-sections">
                    <div class="settings-section">
                        <h3>ุฅุนุฏุงุฏุงุช ุงููุธุงู</h3>
                        <div class="setting-item">
                            <label>ุงููุถุน ุงููุธูู</label>
                            <button onclick="toggleTheme()">ุชุจุฏูู</button>
                        </div>
                        <div class="setting-item">
                            <label>ูุณุญ ุฌููุน ุงูุจูุงูุงุช</label>
                            <button onclick="clearAllData()" class="danger">ูุณุญ</button>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h3>ุฅุนุฏุงุฏุงุช ุงูุฃูุงู</h3>
                        <div class="setting-item">
                            <label>ุชุบููุฑ PIN ูุฌูุฉ ุงูุฏุนู</label>
                            <button onclick="changePIN('support')">ุชุบููุฑ</button>
                        </div>
                        <div class="setting-item">
                            <label>ุชุบููุฑ PIN ูุฌูุฉ ุงูุชูุณูู</label>
                            <button onclick="changePIN('coordination')">ุชุบููุฑ</button>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h3>ุงููุณุฎ ุงูุงุญุชูุงุทู</h3>
                        <div class="setting-item">
                            <label>ุชุตุฏูุฑ ุฌููุน ุงูุจูุงูุงุช</label>
                            <button onclick="exportAllData()">ุชุตุฏูุฑ JSON</button>
                        </div>
                        <div class="setting-item">
                            <label>ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช</label>
                            <input type="file" id="importFile" accept=".json" onchange="importData()" style="display: none;">
                            <button onclick="document.getElementById('importFile').click()">ุงุณุชูุฑุงุฏ JSON</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Complaints List Screen -->
        <div id="complaintsList" class="screen">
            <div class="container">
                <header class="screen-header">
                    <h2 id="complaintsListTitle">ุงูุดูุงูู</h2>
                    <div class="header-actions">
                        <input type="search" id="complaintsSearch" placeholder="ุจุญุซ ูู ุงูุดูุงูู...">
                        <select id="statusFilter">
                            <option value="">ุฌููุน ุงูุญุงูุงุช</option>
                            <option value="NEW">ุฌุฏูุฏ</option>
                            <option value="IN_REVIEW">ููุฏ ุงููุฑุงุฌุนุฉ</option>
                            <option value="RESOLVED_SUPPORT">ูุญููู - ุงูุฏุนู</option>
                            <option value="ESCALATED">ูุญูู</option>
                            <option value="RESOLVED_COORD">ูุญููู - ุงูุชูุณูู</option>
                            <option value="CLOSED">ูุบูู</option>
                            <option value="REJECTED">ูุฑููุถ</option>
                        </select>
                        <button onclick="goBack()">โ ุงูุนูุฏุฉ</button>
                    </div>
                </header>
                
                <div id="complaintsListContent" class="complaints-grid"></div>
            </div>
        </div>

        <!-- Complaint Detail Screen -->
        <div id="complaintDetail" class="screen">
            <div class="container">
                <header class="screen-header">
                    <h2>ุชูุงุตูู ุงูุดููู</h2>
                    <div class="header-actions">
                        <button onclick="printComplaint()" title="ุทุจุงุนุฉ">๐จ๏ธ</button>
                        <button onclick="goBack()">โ ุงูุนูุฏุฉ</button>
                    </div>
                </header>
                
                <div id="complaintDetailContent"></div>
            </div>
        </div>
    </div>

    <!-- Toast notifications -->
    <div id="toast" class="toast"></div>

    <!-- Loading overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
    </div>

    <script src="app.js"></script>
</body>
</html>